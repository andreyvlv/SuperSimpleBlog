CKEDITOR.plugins.add("colorbutton",{requires:"panelbutton,floatpanel",lang:"af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"bgcolor,textcolor",hidpi:!0,init:function(m){function t(t){var e=t.name,n=t.type,o=t.title,r=t.order,l=t.commandName;t=t.contentTransformations||{};var a,c=new CKEDITOR.style(C["colorButton_"+n+"Style"]),s=CKEDITOR.tools.getNextId()+"_colorBox",i={type:n},u=new CKEDITOR.style(C["colorButton_"+n+"Style"],{color:"inherit"});m.addCommand(l,{contextSensitive:!0,exec:function(t,e){var o;t.readOnly||(o=e.newStyle,t.removeStyle(u),t.focus(),o&&t.applyStyle(o),t.fire("saveSnapshot"))},refresh:function(t,e){u.checkApplicable(e,t,t.activeFilter)?u.checkActive(e,t)?this.setState(CKEDITOR.TRISTATE_ON):this.setState(CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_DISABLED)}}),m.ui.add(e,CKEDITOR.UI_PANELBUTTON,{label:o,title:o,command:l,editorFocus:0,toolbar:"colors,"+r,allowedContent:c,requiredContent:c,contentTransformations:t,panel:{css:CKEDITOR.skin.getPath("editor"),attributes:{role:"listbox","aria-label":T.panelTitle}},select:function(t){var e=C.colorButton_colors.split(",");t=f(t=CKEDITOR.tools.array.find(e,t)),d(a,t),a._.markFirstDisplayed()},onBlock:function(t,e){(a=e).autoSize=!0,e.element.addClass("cke_colorblock"),e.element.setHtml(function(t){function e(t){t=t&&new CKEDITOR.style(u,{color:t}),m.execCommand(l,{newStyle:t})}var o=t.type,r=t.colorBoxId,n=t.colorData,l=t.commandName;t=[];var a=C.colorButton_colors.split(","),c=C.colorButton_colorsPerRow||6,s=m.plugins.colordialog&&!1!==C.colorButton_enableMore,i=a.length+(s?2:1),u=m.config["colorButton_"+o+"Style"];u.childRule="back"==o?b:function(t){return!(t.is("a")||t.getElementsByTag("a").count())||b(t)};var d=CKEDITOR.tools.addFunction(function(t){m.focus(),m.fire("saveSnapshot"),"?"==t?m.getColorFromDialog(function(t){t&&e(t)},null,n):e(t&&"#"+t)});for(!1!==C.colorButton_enableAutomatic&&t.push('<a class="cke_colorauto" _cke_focus=1 hidefocus=true title="',T.auto,'" draggable="false" ondragstart="return false;" onclick="CKEDITOR.tools.callFunction(',d,",null,'",o,"');return false;\" href=\"javascript:void('",T.auto,'\')" role="option" aria-posinset="1" aria-setsize="',i,'"><table role="presentation" cellspacing=0 cellpadding=0 width="100%"><tr><td colspan="'+c+'" align="center"><span class="cke_colorbox" id="',r,'"></span>',T.auto,"</td></tr></table></a>"),t.push('<table role="presentation" cellspacing=0 cellpadding=0 width="100%">'),r=0;r<a.length;r++){0==r%c&&t.push("</tr><tr>");var f=a[r].split("/"),g=f[0],p=f[1]||g;t.push('<td><a class="cke_colorbox" _cke_focus=1 hidefocus=true title="',f[1]?g:m.lang.colorbutton.colors[p]||p,'" draggable="false" ondragstart="return false;" onclick="CKEDITOR.tools.callFunction(',d,",'",p,"','",o,"'); return false;\" href=\"javascript:void('",p,'\')" data-value="'+p+'" role="option" aria-posinset="',r+2,'" aria-setsize="',i,'"><span class="cke_colorbox" style="background-color:#',p,'"></span></a></td>')}return s&&t.push('</tr><tr><td colspan="'+c+'" align="center"><a class="cke_colormore" _cke_focus=1 hidefocus=true title="',T.more,'" draggable="false" ondragstart="return false;" onclick="CKEDITOR.tools.callFunction(',d,",'?','",o,"');return false;\" href=\"javascript:void('",T.more,"')\"",' role="option" aria-posinset="',i,'" aria-setsize="',i,'">',T.more,"</a></td>"),t.push("</tr></table>"),t.join("")}({type:n,colorBoxId:s,colorData:i,commandName:l})),e.element.getDocument().getBody().setStyle("overflow","hidden"),CKEDITOR.ui.fire("ready",this);var o=e.keys,r="rtl"==m.lang.dir;o[r?37:39]="next",o[40]="next",o[9]="next",o[r?39:37]="prev",o[38]="prev",o[CKEDITOR.SHIFT+9]="prev",o[32]="click"},onOpen:function(){var t=(o=m.getSelection())&&o.getStartElement(),e=m.elementPath(t);if(!e)return null;for(t=e.block||e.blockLimit||m.document.getBody();e=t&&t.getComputedStyle("back"==n?"background-color":"color")||"transparent","back"==n&&"transparent"==e&&t&&(t=t.getParent()););if(e&&"transparent"!=e||(e="#ffffff"),!1!==C.colorButton_enableAutomatic&&this._.panel._.iframe.getFrameDocument().getById(s).setStyle("background-color",e),t=o&&o.getRanges()[0]){for(var o=new CKEDITOR.dom.walker(t),r=t.collapsed?t.startContainer:o.next(),t="";r;){if(r.type!==CKEDITOR.NODE_ELEMENT&&(r=r.getParent()),r=f(r.getComputedStyle("back"==n?"background-color":"color")),(t=t||r)!==r){t="";break}r=o.next()}"transparent"==t&&(t=""),"fore"==n&&(i.automaticTextColor="#"+f(e)),i.selectionColor=t?"#"+t:"",d(a,t)}return e}})}function b(t){return"false"==t.getAttribute("contentEditable")||t.getAttribute("data-nostyle")}function d(t,e){for(var o=t._.getItems(),r=0;r<o.count();r++){var n=o.getItem(r);n.removeAttribute("aria-selected"),e&&e==f(n.getAttribute("data-value"))&&n.setAttribute("aria-selected",!0)}}function f(t){return CKEDITOR.tools.normalizeHex("#"+CKEDITOR.tools.convertRgbToHex(t||"")).replace(/#/g,"")}var e,o,C=m.config,T=m.lang.colorbutton;CKEDITOR.env.hc||(t({name:"TextColor",type:"fore",commandName:"textColor",title:T.textColorTitle,order:10,contentTransformations:[[{element:"font",check:"span{color}",left:function(t){return!!t.attributes.color},right:function(t){t.name="span",t.attributes.color&&(t.styles.color=t.attributes.color),delete t.attributes.color}}]]}),void 0!==(o=m.config.colorButton_normalizeBackground)&&!o||(e=[[{element:"span",left:function(t){var e=CKEDITOR.tools;return!("span"!=t.name||!t.styles||!t.styles.background)&&((t=e.style.parse.background(t.styles.background)).color&&1===e.object.keys(t).length)},right:function(t){var e=new CKEDITOR.style(m.config.colorButton_backStyle,{color:t.styles.background}).getDefinition();return t.name=e.element,t.styles=e.styles,t.attributes=e.attributes||{},t}}]]),t({name:"BGColor",type:"back",commandName:"bgColor",title:T.bgColorTitle,order:20,contentTransformations:e}))}}),CKEDITOR.config.colorButton_colors="1ABC9C,2ECC71,3498DB,9B59B6,4E5F70,F1C40F,16A085,27AE60,2980B9,8E44AD,2C3E50,F39C12,E67E22,E74C3C,ECF0F1,95A5A6,DDD,FFF,D35400,C0392B,BDC3C7,7F8C8D,999,000",CKEDITOR.config.colorButton_foreStyle={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},CKEDITOR.config.colorButton_backStyle={element:"span",styles:{"background-color":"#(color)"}};